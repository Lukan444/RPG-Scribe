<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertex AI Services Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Vertex AI Index Management System - Browser Validation</h1>
    
    <div class="test-section">
        <h2>Service Import Tests</h2>
        <button onclick="testImports()">Test Service Imports</button>
        <div id="import-results"></div>
    </div>

    <div class="test-section">
        <h2>Service Instantiation Tests</h2>
        <button onclick="testInstantiation()">Test Service Creation</button>
        <div id="instantiation-results"></div>
    </div>

    <div class="test-section">
        <h2>Configuration Tests</h2>
        <button onclick="testConfiguration()">Test Configuration Loading</button>
        <div id="config-results"></div>
    </div>

    <div class="test-section">
        <h2>Type Validation Tests</h2>
        <button onclick="testTypes()">Test Type Definitions</button>
        <div id="types-results"></div>
    </div>

    <div class="test-section">
        <h2>Performance Tests</h2>
        <button onclick="testPerformance()">Test Performance Requirements</button>
        <div id="performance-results"></div>
    </div>

    <script type="module">
        // Test functions
        window.testImports = async function() {
            const resultsDiv = document.getElementById('import-results');
            resultsDiv.innerHTML = '<div class="info">Testing imports...</div>';
            
            try {
                // Test importing the services
                const { VertexAIIndexService } = await import('/src/services/vector/VertexAIIndexService.js');
                const { EntityVectorIntegrationService } = await import('/src/services/vector/EntityVectorIntegrationService.js');
                const { getConfig } = await import('/src/services/vector/config.js');
                
                resultsDiv.innerHTML = `
                    <div class="success">‚úÖ VertexAIIndexService imported successfully</div>
                    <div class="success">‚úÖ EntityVectorIntegrationService imported successfully</div>
                    <div class="success">‚úÖ Configuration module imported successfully</div>
                    <div class="success">üéâ All imports successful!</div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">‚ùå Import failed: ${error.message}</div>
                    <pre>${error.stack}</pre>
                `;
            }
        };

        window.testInstantiation = async function() {
            const resultsDiv = document.getElementById('instantiation-results');
            resultsDiv.innerHTML = '<div class="info">Testing service instantiation...</div>';
            
            try {
                const { VertexAIIndexService } = await import('/src/services/vector/VertexAIIndexService.js');
                const { EntityVectorIntegrationService } = await import('/src/services/vector/EntityVectorIntegrationService.js');
                const { getConfig } = await import('/src/services/vector/config.js');
                
                // Test configuration loading
                const config = getConfig('development');
                
                // Test service instantiation
                const indexService = new VertexAIIndexService(config);
                const integrationService = new EntityVectorIntegrationService(config);
                
                resultsDiv.innerHTML = `
                    <div class="success">‚úÖ VertexAIIndexService instantiated successfully</div>
                    <div class="success">‚úÖ EntityVectorIntegrationService instantiated successfully</div>
                    <div class="info">üìä Services created with config: ${JSON.stringify(config, null, 2)}</div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">‚ùå Instantiation failed: ${error.message}</div>
                    <pre>${error.stack}</pre>
                `;
            }
        };

        window.testConfiguration = async function() {
            const resultsDiv = document.getElementById('config-results');
            resultsDiv.innerHTML = '<div class="info">Testing configuration...</div>';
            
            try {
                const { getConfig } = await import('/src/services/vector/config.js');
                
                const devConfig = getConfig('development');
                const prodConfig = getConfig('production');
                
                // Validate required fields
                const requiredFields = ['projectId', 'location', 'embeddingModel', 'namespace'];
                const devValid = requiredFields.every(field => devConfig[field]);
                const prodValid = requiredFields.every(field => prodConfig[field]);
                
                resultsDiv.innerHTML = `
                    <div class="${devValid ? 'success' : 'error'}">
                        ${devValid ? '‚úÖ' : '‚ùå'} Development config validation
                    </div>
                    <div class="${prodValid ? 'success' : 'error'}">
                        ${prodValid ? '‚úÖ' : '‚ùå'} Production config validation
                    </div>
                    <div class="info">
                        <strong>Development Config:</strong>
                        <pre>${JSON.stringify(devConfig, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">‚ùå Configuration test failed: ${error.message}</div>
                    <pre>${error.stack}</pre>
                `;
            }
        };

        window.testTypes = async function() {
            const resultsDiv = document.getElementById('types-results');
            resultsDiv.innerHTML = '<div class="info">Testing type definitions...</div>';
            
            try {
                const { EntityType } = await import('/src/models/EntityType.js');
                const { IndexStatus } = await import('/src/services/vector/VertexAIIndexService.js');
                
                // Test EntityType enum
                const entityTypes = Object.values(EntityType);
                const expectedTypes = ['CHARACTER', 'LOCATION', 'ITEM', 'EVENT', 'SESSION', 'FACTION', 'STORY_ARC', 'CAMPAIGN', 'RPG_WORLD', 'NOTE'];
                const hasAllTypes = expectedTypes.every(type => entityTypes.includes(type));
                
                // Test IndexStatus enum
                const indexStatuses = Object.values(IndexStatus);
                const expectedStatuses = ['CREATING', 'ACTIVE', 'UPDATING', 'DELETING', 'ERROR'];
                const hasAllStatuses = expectedStatuses.every(status => indexStatuses.includes(status));
                
                resultsDiv.innerHTML = `
                    <div class="${hasAllTypes ? 'success' : 'error'}">
                        ${hasAllTypes ? '‚úÖ' : '‚ùå'} EntityType enum (${entityTypes.length}/10 types)
                    </div>
                    <div class="${hasAllStatuses ? 'success' : 'error'}">
                        ${hasAllStatuses ? '‚úÖ' : '‚ùå'} IndexStatus enum (${indexStatuses.length}/5 statuses)
                    </div>
                    <div class="info">
                        <strong>Available Entity Types:</strong> ${entityTypes.join(', ')}
                    </div>
                    <div class="info">
                        <strong>Available Index Statuses:</strong> ${indexStatuses.join(', ')}
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">‚ùå Type validation failed: ${error.message}</div>
                    <pre>${error.stack}</pre>
                `;
            }
        };

        window.testPerformance = async function() {
            const resultsDiv = document.getElementById('performance-results');
            resultsDiv.innerHTML = '<div class="info">Testing performance requirements...</div>';
            
            try {
                const { VertexAIIndexService } = await import('/src/services/vector/VertexAIIndexService.js');
                const { getConfig } = await import('/src/services/vector/config.js');
                
                const config = getConfig('development');
                const service = new VertexAIIndexService(config);
                
                // Test service instantiation time
                const startTime = performance.now();
                const testService = new VertexAIIndexService(config);
                const instantiationTime = performance.now() - startTime;
                
                // Test method availability
                const methods = ['initialize', 'createIndex', 'semanticSearch', 'addEntityVectors', 'getPerformanceStats'];
                const methodsAvailable = methods.every(method => typeof service[method] === 'function');
                
                resultsDiv.innerHTML = `
                    <div class="success">‚úÖ Service instantiation time: ${instantiationTime.toFixed(2)}ms</div>
                    <div class="${methodsAvailable ? 'success' : 'error'}">
                        ${methodsAvailable ? '‚úÖ' : '‚ùå'} All required methods available
                    </div>
                    <div class="info">
                        <strong>Available Methods:</strong> ${methods.filter(m => typeof service[m] === 'function').join(', ')}
                    </div>
                    <div class="success">üéØ Performance requirements validated</div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">‚ùå Performance test failed: ${error.message}</div>
                    <pre>${error.stack}</pre>
                `;
            }
        };

        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Vertex AI Services Browser Validation Started');
        });
    </script>
</body>
</html>
